# Домашнее задание к занятию "11.03 Микросервисы: подходы"

Вы работаете в крупной компанию, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps специалисту необходимо выдвинуть предложение по организации инфраструктуры, для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- Облачная система;
- Система контроля версий Git;
- Репозиторий на каждый сервис;
- Запуск сборки по событию из системы контроля версий;
- Запуск сборки по кнопке с указанием параметров;
- Возможность привязать настройки к каждой сборке;
- Возможность создания шаблонов для различных конфигураций сборок;
- Возможность безопасного хранения секретных данных: пароли, ключи доступа;
- Несколько конфигураций для сборки из одного репозитория;
- Кастомные шаги при сборке;
- Собственные докер образы для сборки проектов;
- Возможность развернуть агентов сборки на собственных серверах;
- Возможность параллельного запуска нескольких сборок;
- Возможность параллельного запуска тестов;

Обоснуйте свой выбор.

Инструменты разработки и сборки
Это основа конвейерного стека CI/CD. Лучшие инструменты в этой категории могут управлять 
несколькими потоками событий и легко интегрироваться с внешними инструментами.
Инструмент SCM + CI: Gitlab и Gitlab-CI
Gitlab — основной инструмент жизненного цикла DevOps, и он станет инновационным лидером в ближайшем будущем.

Основная функциональность Gitlab обеспечивает безупречный инструмент 
управления GIT-хранилищем. Его веб-интерфейс является наиболее подробным 
и простым в использовании. Gitlab предоставляет все необходимое с бесплатным 
предложением уровня и поставляется в форм-факторах SaaS и On-Prem.

Ключевые преимущества
Возраст — продукт существует на рынке с 2013 года и является чрезвычайно стабильным и хорошо поддерживается.
Открытый исходный код — бесплатная версия Gitlab не ограничивает основные функциональные возможности, которые нужны командам разработчиков. Каждый платный уровень предоставляет дополнительные функции, которые приносят огромную пользу в зависимости от размера и потребностей вашей организации.
Укоренившаяся CI — ни один другой инструмент на рынке не внедрил непрерывную интеграцию непосредственно в ваш SCM, как Gitlab-CI. Использования Docker для беспроблемного создания сборок, а встроенные отчеты упрощают отладку сбоев. Там нет сложной интеграции и оркестровки нескольких инструментов.
Неограниченные интеграции — Gitlab обеспечивает простую интеграцию инструментов, необходимых в каждой из основных категорий DevOps. Это позволяет разработчикам и операциям иметь единый правдивый источник информации, относящейся к их применению.
Инструмент управления данными: FlywayDB
Наиболее игнорируемым аспектом разработки являются потребности в автоматизации 
базы данных. Часто возникает мысль о развертывании изменений схемы базы данных 
для новых версий приложения. Изменения схемы часто добавляют или переименовывают 
столбцы или таблицы. Если версия приложения не соответствует версии схемы, приложение 
может полностью сломаться. Также может быть сложно организовать изменение базы данных 
при обновлении приложения, поскольку существуют две разные системы. FlyWayDB решает все эти проблемы.

Ключевые преимущества
Управление версиями базы данных — FlyWay позволяет вам просто создавать версии базы данных, отслеживать миграцию базы данных и легко откатывать или возвращать изменения схемы без какого-либо специального решения для этого.
Двоичный или встроенный — у вас есть возможность запускать Flyway как часть запуска вашего приложения или как двоичный исполняемый файл. Используйте этот инструмент в своем коде, чтобы он проверял возможности версий при запуске и запускал соответствующие миграции, поддерживая синхронизацию версий базы данных и приложений. Вы также можете запустить команду cmd line ad-hoc, предоставляя гибкость для существующих баз данных без перестройки всего приложения.

Инструмент автоматизированного тестирования: Cucumber
Cucumber объединяет спецификации и тестовую документацию в единый, живой документ. 
Поскольку они автоматически тестируются компанией Cucumber, ваши спецификации всегда 
актуальны.

Ключевые преимущества
Разработка, основанная на поведении — Cucumber предназначен для тестирования BDD, который стал 
основой для тестирования (по сравнению с традиционной разработкой, основанной на тестировании).
Живая документация. Документировать все, что вы сделали, это всегда боль. Поскольку ваши тесты 
определены как код, Cucumber тестирует автоматически генерируемую документацию, чтобы убедиться, 
что они всегда синхронизированы.
Поддержка. Существует множество инструментов, из которых можно выбирать, но когда дела становятся 
серьезными, вам нужна серьезная поддержка со стороны сопровождающего инструмента. У Cucumber есть 
финансирование и структура поддержки, чтобы поддерживать инструмент на долгие годы.
 

Инструменты развертывания
Инструменты развертывания являются, вероятно, наименее понятным аспектом разработки приложений. 
Сложно использовать инструмент развертывания без глубокого понимания кода и функциональности приложения. 
Для разработчиков управление развертыванием кода является новой обязанностью, поэтому у них мало опыта 
работы со многими инструментами развертывания.

Инструмент управления артефактами: Nexus
Хранилище артефактов Nexus поддерживает практически все основные технологии, от Java до NPM и Docker. 
Этот инструмент можно использовать для хранения всех наших развертываемых артефактов. Возможность 
прокси-управления удаленными менеджерами пакетов также значительно увеличивает скорость наших сборок 
CI, приближая пакеты к процессу сборки. Еще одним преимуществом этого является то, что можно получить 
общее представление обо всех пакетах, используемых в нескольких программных проектах, блокируя 
небезопасные пакеты с открытым исходным кодом, которые могут быть вектором атаки в коде.

Ключевые преимущества
Технологическая поддержка — продукт присутствует на рынке с 2013 года и является чрезвычайно 
стабильным и хорошо поддерживается.
Открытый исходный код — бесплатная версия Gitlab не ограничивает основные функциональные 
возможности, которые нужны командам разработчиков. Каждый платный уровень предоставляет 
дополнительные функции, которые приносят огромную пользу в зависимости от размера и 
потребностей вашей организации.

Инструмент управления конфигурацией: Ansible
Ansible является лидером в этом направлении. Более ранние инструменты управления конфигурацией на сцене были сосредоточены на управлении состоянием нашей конфигурации. Если он выйдет из режима блокировки с нужным конфигом, он исправит себя. В новых приложениях у нас есть только компоненты без сохранения состояния. Новые версии кода являются новыми артефактами и развернуты для замены чего-либо существующего. 

Ключевые преимущества
Stateless — Ansible playbook запускаются с компьютера оператора и попадают в сервер. Состояние удаленного объекта не имеет значение, что упрощает использование такого инструмента, как Packer, для создания развертываемых объектов.
Открытый исходный код — как и CentOS, Ansible также поддерживается RedHat. Это предприятие и его высокий уровень поддержки помогают поддерживать сообщество и обеспечивают высококачественные, простые в использовании модули.
YAML — по сравнению с другими инструментами, YAML легче обернуть голову. Поскольку управление конфигурацией, как правило, является новым для тех, кто принимает DevOps, это делает его ключевым пунктом продажи.
Инструмент развертывания: Terraform
Terraform решает проблему определения вашей инфраструктуры как кода, от сетевых компонентов до реальных образов сервера. Он прошел долгий путь с момента первого выпуска и создал огромное сообщество плагинов и поддержки, которые помогут практически в любом сценарии развертывания, с которым вы можете столкнуться. Способность поддерживать любой тип среды, локально, в облаке или что-то еще, не имеет себе равных. Наконец, последняя версия предоставляет большую часть тех же логических функций и классов в HCL, что и любой другой традиционный язык программирования, что позволяет разработчикам легко выбирать и изучать.

Ключевые преимущества
Независимость от облачной среды — Terraform использует сервисы, которые действуют как интерфейс между вашим кодом Terraform и всем API и внутренней логикой, необходимой для связи с вашим поставщиком инфраструктуры. Это означает, что я могу выучить один инструмент и иметь возможность работать где угодно.
Открытый исходный код — Опять же, трудно выбить бесплатные инструменты. Поддержка сообщества на высшем уровне.
 

Инструменты среды выполнения
Инструмент XaaS: Amazon Web Services
Amazon всегда был лидером в облаке. Они не просто не останавливаются на этом — 
у них есть так много новых сервисов, которые разработчики могут использовать. 
Перенесите любую технологию и любой шаблон в AWS, и он может быть построен и запущен. 
Их стоимость чрезвычайно разумна по сравнению со сборкой, управлением и обслуживанием 
традиционного оборудования в вашем собственном центре обработки данных. Бесплатный 
уровень услуг дает каждому возможность поэкспериментировать с чем-либо, прежде чем 
принимать решение о покупке, что отлично подходит для попыток построить приложение 
правильным способом вместо необходимости идти на компромисс из-за затрат.

Ключевые преимущества
Промышленный стандарт. Если у вас есть опыт создания приложений в AWS, вы можете получить работу где угодно. Предприятия любят AWS, а стартапы — низкую стоимость AWS.
Free-Tier — это действительно бизнес-аспект, который AWS сделал так правильно по сравнению со всем остальным.

Инструмент оркестровки: OpenShift
Вы, вероятно, используете Docker или контейнеры где-то в вашем стеке приложений. Безсерверные приложения хороши, но они не могут соответствовать каждому шаблону архитектуры. Запуск контейнеров без платформы оркестровки просто не работает. OpenShift является единственной платформой Kubernetes, которая имеет все это от сборок Source2Image, автоматизации развертывания в модули и даже отслеживания и мониторинга. Он может быть запущен сразу, в облаке или в обоих случаях.

Ключевые преимущества
Встроенная система безопасности — для управления безопасностью K8 может потребоваться докторская степень. 
Надо тщательно продумать и учесть каждую деталь. Механизмы безопасности, установленные по умолчанию 
с помощью OpenShift, отнимают много лишних функциональных нагрузок у разработчиков и обеспечивают 
более безопасную платформу для их приложений.
Решение «все в одном» — в отличие от vanilla K8, который по умолчанию не включает инструменты 
балансировки нагрузки, в OpenShift есть все. Его можно использовать для размещения своих контейнеров, 
создания контейнеров, запуска инструментов CI/CD, управления внешними процессами и многого другого. 
Хотя GUI по-прежнему требует немного больше работы, подход API-first означает, что все может быть 
написано в сценарии, и, в отличие от других графических интерфейсов для K8, он значительно упрощает 
изучение основ Kubernetes без предварительной получения этой степени!

Инструмент мониторинга:  New Relic 
Ранние выпуски New Relic сделали одну вещь действительно хорошо — мониторинг APM. 
Теперь это полнофункциональный инструмент мониторинга, позволяющий мне отслеживать 
производительность сервера, производительность контейнера, производительность базы данных, 
мониторинг конечного пользователя и, конечно, мониторинг APM.

Ключевые преимущества
Простота использования — это SaaS, поэтому не нужно настраивать серверный компонент.
Сквозная видимость — другие инструменты пытаются отслеживать один конкретный аспект вашего приложения. Будь то загрузка ЦП или сетевой трафик, все эти слои работают вместе, чтобы ваше приложение работало. New Relic дает вам возможность объединить все данные, чтобы получить истинное представление о том, что происходит.

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- Сбор логов в центральное хранилище со всех хостов обслуживающих систему;
- Минимальные требования к приложениям, сбор логов из stdout;
- Гарантированная доставка логов до центрального хранилища;
- Обеспечение поиска и фильтрации по записям логов;
- Обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- Возможность дать ссылку на сохраненный поиск по записям логов;

Обоснуйте свой выбор.

Для сбора логов я бы предложил ELK. 

Состав комплекса:
FileBeat - агент, собирающий данные с машины и направляющий в Elasticsearch
Logstash - служба обрабатывающая данные: фильтрует, парсит на составляющие поля, агрегирует строки, 
обогащает данные при необходимости и т.п. передает данные в системы потребители при необходимости.
Elasticsearch - инструмент аналитики и полнотекстового поиска,  
позволяет хранить, оперативно получать нужные данные больших объемов
Kibana - Web визуальный инструмент для Elasticsearch, позволяет управлять индексами Elasticsearch, 
выполнять непосредственный визуальный поиск, строить Dashbord-ы для 
удобства оперативного анализа логов(данных).


Преимущества: масштабируемость, относительная простота, отказоустойчивость, гибкость, 
универсальность (работает со множеством источником данных).
В Ентерпрайз версии имеет повышенные возможности, в частности Machine Learning 
для анализа и поиска аномалий, 
что позволяет реагировать проактивно при наличии проблем в системах, до наступления деградаций и сбоев

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- Сбор метрик со всех хостов, обслуживающих систему;
- Сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- Сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- Сбор метрик, специфичных для каждого сервиса;
- Пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- Пользовательский интерфейс с возможность настраивать различные панели для отслеживания состояния системы;

Обоснуйте свой выбор.

Prometheus + Grafana. 

Состав:
Prometheus - набор инструментов для мониторинга и оповещения систем с открытым исходным кодом, 
собирает и хранит метрики в виде временных рядов, 
т.е. информация о метриках хранится с меткой времени, в которую она была записана
Grafana - веб-интерфейс для работы с данными, строит на оперативных данных графики. 
Позволяет визуализировать данные с систем мониторинга и большого числа разных метрик, 
в том числе с большинства источников данных,
Так же интегрируется с Elasticsearch, который рекомендован в задаче 2, для хранения логов, 
создавая очень удобный комплекс.

По факту является практически стандартом при использовании микросервисов.

Преимущества: 
красивая визуализация(Grafana), простое управление, интеграция с различными системами и источниками 
данных, поддерживается комьюнити, 
имеет возможность созданиядостаточно гибких запросов в том числе с агрегацией и выборкой 
(которые не реализуемы внутри Kibana).

## Задача 4: Логи * (необязательная)

Продолжить работу по задаче API Gateway: сервисы используемые в задаче пишут логи в stdout. 

Добавить в систему сервисы для сбора логов Vector + ElasticSearch + Kibana со всех сервисов обеспечивающих работу API.

### Результат выполнения: 

docker compose файл запустив который можно перейти по адресу http://localhost:8081 по которому доступна Kibana.
Логин в Kibana должен быть admin пароль qwerty123456


## Задача 5: Мониторинг * (необязательная)

Продолжить работу по задаче API Gateway: сервисы используемые в задаче предоставляют набор метрик в формате prometheus:

- Сервис security по адресу /metrics
- Сервис uploader по адресу /metrics
- Сервис storage (minio) по адресу /minio/v2/metrics/cluster

Добавить в систему сервисы для сбора метрик (Prometheus и Grafana) со всех сервисов обеспечивающих работу API.
Построить в Graphana dashboard показывающий распределение запросов по сервисам.

### Результат выполнения: 

docker compose файл запустив который можно перейти по адресу http://localhost:8081 по которому доступна Grafana с настроенным Dashboard.
Логин в Grafana должен быть admin пароль qwerty123456

---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
